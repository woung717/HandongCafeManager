CREATE TABLE USERS (
   ID VARCHAR(20) NOT NULL,
   PASSWORD VARCHAR(20) NOT NULL,
   UNAME VARCHAR(10) DEFAULT "",
   BIRTH DATE,
   SEX CHAR(1) DEFAULT "M",
   TYPE CHAR(1) DEFAULT "C",
   PRIMARY KEY (ID),
   CHECK (SEX='M' OR SEX='F'),
   CHECK (TYPE='C' OR TYPE='M' OR TYPE='A')
);

CREATE TABLE CAFES (
   CNAME VARCHAR(20) NOT NULL,
   PHONE VARCHAR(15),
   LOCATION VARCHAR(100),
   MANAGER VARCHAR(20),
   PRIMARY KEY (CNAME),
   FOREIGN KEY (MANAGER)
      REFERENCES USERS(ID)
      ON DELETE SET NULL
);

CREATE TABLE COUPON (
   COUPON_ID INT NOT NULL AUTO_INCREMENT,
   CNUMBER INT UNSIGNED NOT NULL DEFAULT 0,
   CUSTOMER VARCHAR(20),
   CAFE VARCHAR(20),
   PRIMARY KEY (COUPON_ID),
   UNIQUE (CUSTOMER, CAFE),
   FOREIGN KEY (CUSTOMER)
      REFERENCES USERS(ID)
      ON DELETE CASCADE,
   FOREIGN KEY (CAFE)
      REFERENCES CAFES(CNAME)
      ON DELETE CASCADE
);

CREATE TABLE MENUS (
   MENUID INT NOT NULL AUTO_INCREMENT,
   CAFE VARCHAR(20) NOT NULL,
   SORT VARCHAR(15) NOT NULL,
   MNAME VARCHAR(30) NOT NULL,
   CALORIE INT UNSIGNED,
   PRICE INT UNSIGNED,
   STOCK INT UNSIGNED,
   PRIMARY KEY (MENUID),
    UNIQUE (CAFE, MNAME),
   FOREIGN KEY (CAFE)
      REFERENCES CAFES(CNAME)
);

CREATE TABLE BEVERAGES (
   MENU INT NOT NULL,
   TEMPERATURE CHAR(3),
   SIZE CHAR,
   CHECK (SIZE='M' OR SIZE='L' OR SIZE='M/L'),
   CHECK (TEMPERATURE='H' OR TEMPERATURE='C' OR TEMPERATURE ='H/C'),
   FOREIGN KEY (MENU)
      REFERENCES MENUS(MENUID)
);

CREATE TABLE ORDERS (
   ISSUE_TIME DATETIME,
   CUSTOMER VARCHAR(20),
   CAFE_NAME VARCHAR(20),
   MENU INT NOT NULL,
   FOREIGN KEY (CUSTOMER)
      REFERENCES USERS(ID),      
   FOREIGN KEY (CAFE_NAME)
      REFERENCES CAFES(CNAME)
        ON DELETE CASCADE,
   FOREIGN KEY (MENU)
      REFERENCES MENUS(MENUID)
);
CREATE TRIGGER SET_DATE_ORDER
BEFORE INSERT ON ORDERS
FOR EACH ROW
   SET NEW.ISSUE_TIME=NOW();

CREATE TABLE INGREDIENT (
   MENU INT NOT NULL,
   NAME VARCHAR(100) NOT NULL,
   FOREIGN KEY (MENU)
      REFERENCES MENUS(MENUID)
        ON DELETE CASCADE
);

CREATE TABLE POST (
   POST_ID INT NOT NULL AUTO_INCREMENT,
   TITLE VARCHAR(100) NOT NULL,
   POST_DATE DATE,
   CONTENT VARCHAR(1024),
   CAFE VARCHAR(20) NOT NULL,
   PRIMARY KEY (POST_ID),
   FOREIGN KEY (CAFE)
      REFERENCES CAFES(CNAME)
);
CREATE TRIGGER SET_DATE
BEFORE INSERT ON POST
FOR EACH ROW
   SET NEW.POST_DATE=CURDATE();